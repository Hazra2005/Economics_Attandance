<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
*{box-sizing:border-box;margin:0;padding:0;}

body{
font-family:'Poppins',sans-serif;
background:linear-gradient(135deg,#4e73df,#1cc88a);
display:flex;
justify-content:center;
align-items:center;
min-height:100vh;
padding:20px;
}

.container{
width:100%;
max-width:750px;
background:white;
padding:25px;
border-radius:20px;
box-shadow:0 15px 35px rgba(0,0,0,0.3);
position:relative;
}

h2{text-align:center;margin-bottom:15px;}

select,button{
width:100%;
padding:12px;
margin-bottom:12px;
border-radius:10px;
border:1px solid #ddd;
}

button{
background:#4e73df;
color:white;
font-weight:600;
cursor:pointer;
}

button:hover{background:#2e59d9;}

.logout-btn{background:#e74a3b;}
.logout-btn:hover{background:#c0392b;}

.database-btn{background:#36b9cc;}
.database-btn:hover{background:#2c9faf;}

table{
width:100%;
border-collapse:collapse;
margin-top:15px;
background:white;
border-radius:12px;
overflow:hidden;
box-shadow:0 8px 20px rgba(0,0,0,0.1);
}

thead{
background:linear-gradient(135deg,#4e73df,#1cc88a);
color:white;
}

th,td{
padding:12px;
text-align:center;
}

tbody tr{
border-bottom:1px solid #eee;
}

tbody tr:hover{
background:#f8f9ff;
}

td input{
width:18px;
height:18px;
accent-color:#4e73df;
cursor:pointer;
}

.loader{
position:absolute;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(255,255,255,0.85);
display:none;
justify-content:center;
align-items:center;
border-radius:20px;
z-index:10;
}

.spinner{
width:45px;
height:45px;
border:5px solid #ccc;
border-top:5px solid #4e73df;
border-radius:50%;
animation:spin 1s linear infinite;
}

@keyframes spin{
0%{transform:rotate(0deg);}
100%{transform:rotate(360deg);}
}
</style>
</head>

<body>

<script>
if(sessionStorage.getItem("adminLoggedIn")!=="true"){
alert("Unauthorized Access ‚ùå Please Login First");
window.location.href="index.html";
}
</script>

<div class="container">

<div class="loader" id="loader">
<div class="spinner"></div>
</div>

<h2>Admin Panel üë®üèª‚Äçüíº</h2>

<select id="department">
<option value="">Select Department & Semester</option>
<option value="CS_4">Computer Science - 4th Sem</option>
<option value="CS_6">Computer Science - 6th Sem</option>
<option value="GEO_4">Geography - 4th Sem</option>
<option value="GEO_6">Geography - 6th Sem</option>
</select>

<div id="studentList"></div>

<button onclick="saveAttendance()">Submit Attendance ‚úî</button>
<button class="database-btn" onclick="viewDatabase()">View Attendance Database üìä</button>

<div id="databaseView"></div>

<button class="logout-btn" onclick="logout()">Logout ‚ùé</button>

</div>

<script>

const SCRIPT_URL="https://script.google.com/macros/s/AKfycbyLZWOug-UBtNm9hRbPDNT7UJtYtETAF4Vq7iPV_Wnmc38D_Wyyxpy4rq-0a37T3i7pVQ/exec";

let students=[];
let selectedDept="";

function showLoader(){document.getElementById("loader").style.display="flex";}
function hideLoader(){document.getElementById("loader").style.display="none";}

function logout(){
sessionStorage.removeItem("adminLoggedIn");
window.location.href="index.html";
}

document.getElementById("department").addEventListener("change",function(){

selectedDept=this.value;
if(selectedDept==="") return;

showLoader();

fetch(`${SCRIPT_URL}?sheet=${selectedDept}`)
.then(res=>res.json())
.then(data=>{

students=[];
let table=`<table>
<thead>
<tr>
<th>Roll</th>
<th>Name</th>
<th>Present</th>
</tr>
</thead><tbody>`;

for(let i=1;i<data.length;i++){
students.push({roll:data[i][0],name:data[i][1]});
table+=`<tr>
<td>${data[i][0]}</td>
<td>${data[i][1]}</td>
<td><input type="checkbox"></td>
</tr>`;
}

table+="</tbody></table>";

document.getElementById("studentList").innerHTML=table;
hideLoader();
});
});

function getSheetName(dept){
if(dept==="CS_4") return "CS4_Attendance";
if(dept==="CS_6") return "CS6_Attendance";
if(dept==="GEO_4") return "GEO4_Attendance";
if(dept==="GEO_6") return "GEO6_Attendance";
}

function saveAttendance(){

if(selectedDept===""){
alert("Select department first");
return;
}

showLoader();

let today=new Date().toLocaleDateString();
let checkboxes=document.querySelectorAll("tbody input");
let sheetName=getSheetName(selectedDept);
let records=[];

checkboxes.forEach((box,index)=>{
let status=box.checked?"Present":"Absent";
records.push([today,students[index].roll,students[index].name,status]);
});

fetch(SCRIPT_URL,{
method:"POST",
body:JSON.stringify({
action:"saveAttendance",
sheet:sheetName,
records:records
})
})
.then(res=>res.json())
.then(()=>{
hideLoader();
alert("Attendance Saved Successfully!");
});
}

function viewDatabase(){

if(selectedDept===""){
alert("Select department first");
return;
}

showLoader();

let sheetName=getSheetName(selectedDept);

fetch(`${SCRIPT_URL}?sheet=${sheetName}`)
.then(res=>res.json())
.then(data=>{

let table="<table><thead><tr><th>Date</th><th>Roll</th><th>Name</th><th>Status</th></tr></thead><tbody>";

for(let i=1;i<data.length;i++){
table+=`<tr>
<td>${data[i][0]}</td>
<td>${data[i][1]}</td>
<td>${data[i][2]}</td>
<td>${data[i][3]}</td>
</tr>`;
}

table+="</tbody></table>";

document.getElementById("databaseView").innerHTML=table;
hideLoader();
});
}

</script>

</body>
</html>
